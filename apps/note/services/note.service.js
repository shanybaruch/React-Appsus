import { utilService } from './util.service.js'
import { storageService } from './async-storage.service.js'

const NOTE_KEY = 'noteDB'
const defaultNotes  = [{
        id: 'n101',
        createdAt: 1112222,
        type: 'NoteTxt',
        isPinned: true,
        style: { backgroundColor: '#00d' },
        info: { txt: 'Fullstack Me Baby!' }
      },
      {
        id: 'n102',
        createdAt: 1112223,
        type: 'NoteImg',
        isPinned: false,
        style: { backgroundColor: '#00d' },
        info: { url: 'data:image/jpeg;base64,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', title: 'Bobi and Me' }
      },
      {
        id: 'n103',
        createdAt: 1112224,
        type: 'NoteTodos',
        isPinned: false,
        style: { backgroundColor: '#00d' },
        info: {
          title: 'Get my stuff together',
          todos: [
            { txt: 'Driving license', doneAt: null },
            { txt: 'Coding power', doneAt: 187111111 }
          ]
        }
      }
    ]

_createNotes()

export const noteService = {
  query,
  get,
  remove,
  save,
  getEmptyNote,
  getDefaultFilter
}
function query() {
  return storageService.query(NOTE_KEY)
    .then(storedNotes => {
      if (!storedNotes || !storedNotes.length) {
        saveToStorage(NOTE_KEY, defaultNotes)
        storedNotes = defaultNotes
      }
      console.log('Notes from query:', storedNotes)
      return storedNotes
    })
}

function get(noteId) {
  return storageService.get(NOTE_KEY, noteId)
}

function remove(noteId) {
  return storageService.remove(NOTE_KEY, noteId)
}

function save(note) {
  if (note.id) {
    return storageService.put(NOTE_KEY, note)
  } else {
    note.id = makeId()
    note.createdAt = Date.now()
    return storageService.post(NOTE_KEY, note)
  }
}

function getEmptyNote(type = 'NoteTxt') {
  switch (type) {
    case 'NoteTxt':
      return { type, info: { txt: '' }, style: { backgroundColor: '#fff' }, isPinned: false }
    case 'NoteImg':
      return { type, info: { url: '', title: '' }, style: { backgroundColor: '#fff' }, isPinned: false }
    case 'NoteTodos':
      return { type, info: { title: '', todos: [] }, style: { backgroundColor: '#fff' }, isPinned: false }
    default:
      return { type, info: {}, style: { backgroundColor: '#fff' }, isPinned: false }
  }
}

function getDefaultFilter() {
  return { txt: '' }
}
function _createNotes() {
  let notes = utilService.loadFromStorage(NOTE_KEY)

  if (!notes || !notes.length) {
    notes = defaultNotes 
    console.log(notes);
    
    utilService.saveToStorage(NOTE_KEY, notes)
  }
}
